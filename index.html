<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחשבון תשואות השקעה</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            direction: rtl;
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        input, button, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
            box-sizing: border-box;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background-color: #e8f4e8;
            border: 1px solid #c8e6c9;
            overflow-x: auto;
            max-height: 0;
            opacity: 0;
            transition: max-height 0.5s ease, opacity 0.5s ease;
        }
        .result.visible {
            max-height: 1000px;
            opacity: 1;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        th {
            background-color: #f2f2f2;
        }
        .view-toggle {
            margin-top: 20px;
            display: flex;
            justify-content: space-around;
        }
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            input, button, select {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>מחשבון תשואות השקעה</h2>
        <label for="initialAmount">סכום השקעה התחלתי:</label>
        <input type="number" id="initialAmount" placeholder="הזן סכום השקעה התחלתי">

        <label for="monthlyWithdrawal">משיכה חודשית:</label>
        <input type="number" id="monthlyWithdrawal" placeholder="הזן משיכה חודשית">

        <label for="returnType">סוג שיעור התשואה:</label>
        <select id="returnType">
            <option value="monthly">תשואה חודשית (%)</option>
            <option value="yearly">תשואה שנתית (%)</option>
        </select>

        <label for="returnRate">שיעור תשואה:</label>
        <input type="number" id="returnRate" placeholder="הזן שיעור תשואה">

        <label for="investmentYears">מספר שנים:</label>
        <input type="number" id="investmentYears" placeholder="הזן מספר שנים">

        <button onclick="calculateReturn()">חשב</button>

        <div class="view-toggle hidden">
            <button onclick="toggleView()">עבור לתצוגה מפורטת</button>
        </div>

        <div class="result" id="detailedView"></div>
        <div class="result" id="annualView"></div>
    </div>

    <script>
        let detailedTable = '';
        let annualTable = '';
        let currentView = 'annual';

        function calculateReturn() {
            let initialAmount = parseFloat(document.getElementById('initialAmount').value);
            let monthlyWithdrawal = parseFloat(document.getElementById('monthlyWithdrawal').value);
            let returnRateType = document.getElementById('returnType').value;
            let returnRate = parseFloat(document.getElementById('returnRate').value) / 100;
            let investmentYears = parseInt(document.getElementById('investmentYears').value);

            let monthlyReturnRate = returnRateType === 'yearly' ? Math.pow(1 + returnRate, 1 / 12) - 1 : returnRate;

            let balance = initialAmount;
            detailedTable = '<table><tr><th>שנה</th><th>חודש</th><th>יתרת פתיחה</th><th>לאחר משיכה</th><th>לאחר תשואה</th></tr>';
            annualTable = '<table><tr><th>שנה</th><th>יתרה בתחילת השנה</th><th>יתרה בסוף השנה</th><th>תשואה</th><th>שינוי כולל</th></tr>';

            for (let year = 1; year <= investmentYears; year++) {
                let startBalanceYear = balance;
                let returnProfitYear = 0;
                for (let month = 1; month <= 12; month++) {
                    let startBalance = balance;
                    balance -= monthlyWithdrawal;
                    if (balance < 0) balance = 0;
                    let afterWithdrawal = balance;
                    let interest = balance * monthlyReturnRate;
                    balance += interest;
                    returnProfitYear += interest;
                    let afterInterest = balance;
                    detailedTable += `<tr><td>${year}</td><td>${month}</td><td>${startBalance.toFixed(2)}</td><td>${afterWithdrawal.toFixed(2)}</td><td>${afterInterest.toFixed(2)}</td></tr>`;
                }
                let endBalanceYear = balance;
                let totalBalanceChange = endBalanceYear - startBalanceYear;
                annualTable += `<tr><td>${year}</td><td>${startBalanceYear.toFixed(2)}</td><td>${endBalanceYear.toFixed(2)}</td><td>${returnProfitYear.toFixed(2)}</td><td>${totalBalanceChange.toFixed(2)}</td></tr>`;
            }
            detailedTable += '</table>';
            annualTable += '</table>';

            document.getElementById('detailedView').innerHTML = detailedTable;
            document.getElementById('annualView').innerHTML = annualTable;
            document.getElementById('annualView').classList.add('visible');
            document.querySelector('.view-toggle').classList.remove('hidden');
            
            currentView = 'annual';
            document.querySelector('.view-toggle button').innerText = 'עבור לתצוגה מפורטת';
            document.getElementById('detailedView').classList.remove('visible');
        }

        function toggleView() {
            if (currentView === 'annual') {
                document.getElementById('annualView').classList.remove('visible');
                document.getElementById('detailedView').classList.add('visible');
                document.querySelector('.view-toggle button').innerText = 'עבור לתצוגה שנתית';
                currentView = 'detailed';
            } else {
                document.getElementById('detailedView').classList.remove('visible');
                document.getElementById('annualView').classList.add('visible');
                document.querySelector('.view-toggle button').innerText = 'עבור לתצוגה מפורטת';
                currentView = 'annual';
            }
        }
    </script>
</body>
</html>
